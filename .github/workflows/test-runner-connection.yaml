name: Test Runner Connection

on:
  workflow_dispatch:

jobs:
  test:
    runs-on: self-hosted
    steps:
    - name: Fix Kubernetes Permissions
      run: |
        mkdir -p ~/.kube
        sudo cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
        sudo chown $USER:$USER ~/.kube/config
        chmod 600 ~/.kube/config

    - name: Test Connection
      run: |
        echo "âœ… Runner is connected!"
        echo "Host: $(hostname)"
        echo "User: $(whoami)"
        
    - name: Check Environment
      run: |
        echo "ğŸ”§ Environment Check:"
        echo "Docker: $(docker --version)"
        echo "Kubectl: $(kubectl version --short 2>/dev/null || echo 'Not available')"
        
    - name: Simple Kubernetes Test
      run: |
        echo "ğŸ” Testing Kubernetes access..."
        kubectl get nodes && echo "âœ… Kubernetes access working!" || echo "âš ï¸ Kubernetes access issue"
